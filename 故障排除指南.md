# 🔧 故障排除指南

## 问题：未能获取数据，请检查股票代码是否正确

如果您遇到这个错误，请按照以下步骤排查：

### 1️⃣ 检查浏览器控制台

1. **打开浏览器开发者工具**
   - Windows/Linux: 按 `F12` 或 `Ctrl+Shift+I`
   - Mac: 按 `Cmd+Option+I`

2. **切换到"Console"（控制台）标签**

3. **查看详细错误信息**
   - 会显示类似这样的日志：
   ```
   === 开始获取数据 ===
   股票代码: 0700.HK
   数据源: yahoo
   时间范围: 3mo
   Fetching data from: https://query1.finance.yahoo.com/...
   Response: {...}
   ```

4. **根据错误类型排查**：

### 2️⃣ 常见问题及解决方案

#### ❌ CORS跨域错误
**错误信息**: `Access to fetch at '...' from origin '...' has been blocked by CORS policy`

**原因**: 浏览器安全策略阻止了跨域请求

**解决方案**:
1. **方案A（推荐）**: 将HTML文件部署到Web服务器
   ```bash
   # 使用Python快速启动服务器
   python -m http.server 8000
   # 然后访问 http://localhost:8000/stock_analysis_professional.html
   ```

2. **方案B**: 使用支持CORS的浏览器启动方式
   - Chrome: 
   ```bash
   # Windows
   chrome.exe --disable-web-security --user-data-dir="C:/Chrome dev session"
   
   # Mac
   open -n -a "Google Chrome" --args --disable-web-security --user-data-dir="/tmp/chrome_dev"
   ```
   
   ⚠️ **警告**: 仅用于开发测试，不要用于日常浏览

3. **方案C**: 使用Firefox浏览器
   - Firefox的CORS策略相对宽松
   - 直接双击HTML文件打开即可

#### ❌ 网络错误
**错误信息**: `HTTP error! status: 404` 或 `HTTP error! status: 400`

**原因**: 
- 股票代码不存在或格式错误
- Yahoo Finance暂时无法访问

**解决方案**:
1. **检查股票代码格式**:
   - ✅ 正确格式:
     - 美股: `AAPL`, `MSFT`, `TSLA`
     - A股上海: `600519.SS`, `601318.SS`
     - A股深圳: `000858.SZ`, `002594.SZ`
     - 港股: `0700.HK`, `9988.HK`
   
   - ❌ 错误格式:
     - `AAPL.US` (应该是 `AAPL`)
     - `600519` (应该是 `600519.SS`)
     - `0700` (应该是 `0700.HK`)

2. **验证股票代码是否存在**:
   - 访问 https://finance.yahoo.com/
   - 搜索您的股票代码
   - 查看URL中的正确代码格式

3. **尝试其他股票**:
   - 先测试确定有效的股票，如 `AAPL`
   - 如果能成功，说明是特定股票代码的问题

#### ❌ API限流
**错误信息**: `HTTP error! status: 429` 或频繁请求失败

**原因**: Yahoo Finance API限制请求频率

**解决方案**:
1. 等待几分钟后再试
2. 不要频繁刷新
3. 一次只查询一个股票

#### ❌ 没有数据返回
**错误信息**: `没有可用的历史数据`

**原因**: 
- 新上市的股票没有足够的历史数据
- 已退市的股票
- 停牌的股票

**解决方案**:
1. 缩短时间范围（选择"1个月"而不是"1年"）
2. 尝试其他股票
3. 检查该股票是否已退市或停牌

### 3️⃣ 测试步骤

按照以下顺序测试，逐步排除问题：

1. **测试1: 美股Apple**
   - 代码: `AAPL`
   - 时间: 3个月
   - 如果成功 ✅ → 说明系统正常，继续测试2
   - 如果失败 ❌ → 检查网络和CORS问题

2. **测试2: A股茅台**
   - 代码: `600519.SS`
   - 时间: 3个月
   - 如果成功 ✅ → 说明A股代码格式正确
   - 如果失败 ❌ → 检查代码格式

3. **测试3: 港股腾讯**
   - 代码: `0700.HK`
   - 时间: 3个月
   - 如果成功 ✅ → 说明港股代码格式正确
   - 如果失败 ❌ → 检查代码格式

### 4️⃣ 推荐的使用方式

为了避免问题，建议：

1. **使用快速选择功能**
   - 点击"📊 股票市场"或"💼 基金市场"标签
   - 直接点击卡片选择，无需手动输入代码
   - 预置的代码都经过验证，成功率更高

2. **使用简单的HTTP服务器**
   ```bash
   # Python 3
   python -m http.server 8000
   
   # Python 2
   python -m SimpleHTTPServer 8000
   
   # Node.js
   npx http-server
   ```

3. **使用Firefox浏览器**
   - 对本地文件的CORS限制较少
   - 开发测试更方便

### 5️⃣ 高级调试

如果以上方法都不行，请提供以下信息：

1. **浏览器信息**
   - 浏览器类型和版本
   - 操作系统

2. **控制台完整错误信息**
   - 截图或复制所有红色错误信息

3. **测试的股票代码**
   - 您尝试查询的具体代码

4. **网络状态**
   - 能否访问 https://finance.yahoo.com/
   - 能否访问 https://query1.finance.yahoo.com/

### 6️⃣ 备用方案

如果Yahoo Finance完全无法使用：

1. **等待服务恢复**
   - Yahoo Finance偶尔会维护或限流

2. **使用其他数据源**
   - 考虑使用付费API（Alpha Vantage等）
   - 需要申请API Key

3. **导入CSV数据**
   - 从其他平台下载历史数据
   - 修改代码支持CSV导入

## 📞 仍然有问题？

如果按照以上步骤仍然无法解决，请：

1. 打开浏览器控制台（F12）
2. 截图完整的错误信息
3. 说明您的操作步骤
4. 提供测试的股票代码

我会帮您进一步排查！

---

**提示**: 大部分问题都是CORS跨域引起的，使用Web服务器运行HTML文件即可解决！



